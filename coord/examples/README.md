# Coord æ¨¡å—ç¤ºä¾‹

æœ¬ç›®å½•æä¾›äº† coord æ¨¡å—çš„å®Œæ•´ä½¿ç”¨ç¤ºä¾‹ï¼Œæ¶µç›–åˆ†å¸ƒå¼é”ã€é…ç½®ä¸­å¿ƒã€æœåŠ¡æ³¨å†Œå‘ç°å’ŒIDç”Ÿæˆå™¨å››å¤§æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œå¿«é€Ÿå…¥é—¨ç¤ºä¾‹

```bash
# æŸ¥çœ‹æ‰€æœ‰åŠŸèƒ½çš„åŸºæœ¬ç”¨æ³•
cd getting-started
go run main.go
```

### è¿è¡Œç‰¹å®šåŠŸèƒ½ç¤ºä¾‹

```bash
# åˆ†å¸ƒå¼é”ç¤ºä¾‹
cd distributed-lock/basic
go run main.go

# é…ç½®ä¸­å¿ƒç¤ºä¾‹
cd config-center/basic
go run main.go

# æœåŠ¡æ³¨å†Œå‘ç°ç¤ºä¾‹
cd service-discovery/basic
go run main.go

# IDç”Ÿæˆå™¨ç¤ºä¾‹
cd id-generator/basic
go run main.go
```

## ğŸ“ ç›®å½•ç»“æ„

```
coord/examples/
â”œâ”€â”€ README.md                          # æœ¬æ–‡æ¡£
â”œâ”€â”€ getting-started/                   # å¿«é€Ÿå…¥é—¨ - æ‰€æœ‰åŠŸèƒ½ä¸€è§ˆ
â”‚   â””â”€â”€ main.go                        # å››å¤§åŠŸèƒ½çš„åŸºæœ¬ç”¨æ³•æ¼”ç¤º
â”œâ”€â”€ distributed-lock/                 # åˆ†å¸ƒå¼é”ä¸“é¢˜
â”‚   â”œâ”€â”€ basic/                         # åŸºç¡€ç”¨æ³•
â”‚   â”‚   â””â”€â”€ main.go                    # é”è·å–/é‡Šæ”¾ã€é˜»å¡/éé˜»å¡ã€TTLç®¡ç†
â”‚   â”œâ”€â”€ advanced/                      # é«˜çº§ç”¨æ³•
â”‚   â”‚   â””â”€â”€ main.go                    # æ‰‹åŠ¨ç»­çº¦ã€è¿‡æœŸæ£€æŸ¥ã€é•¿æ—¶é—´æŒæœ‰
â”‚   â””â”€â”€ patterns/                      # ä½¿ç”¨æ¨¡å¼
â”‚       â””â”€â”€ main.go                    # é”™è¯¯å¤„ç†ã€é‡è¯•æœºåˆ¶ã€å¹¶å‘æ§åˆ¶
â”œâ”€â”€ config-center/                     # é…ç½®ä¸­å¿ƒä¸“é¢˜
â”‚   â”œâ”€â”€ basic/                         # åŸºç¡€ç”¨æ³•
â”‚   â”‚   â””â”€â”€ main.go                    # é…ç½®CRUDã€ç‰ˆæœ¬æ§åˆ¶ã€å‰ç¼€æ“ä½œ
â”‚   â”œâ”€â”€ watch/                         # é…ç½®ç›‘å¬
â”‚   â”‚   â””â”€â”€ main.go                    # åŠ¨æ€é…ç½®æ›´æ–°ã€äº‹ä»¶ç›‘å¬
â”‚   â””â”€â”€ manager/                       # é…ç½®ç®¡ç†å™¨
â”‚       â””â”€â”€ main.go                    # ç±»å‹å®‰å…¨é…ç½®ç®¡ç†ã€éªŒè¯å™¨ã€æ›´æ–°å™¨
â”œâ”€â”€ service-discovery/                 # æœåŠ¡æ³¨å†Œå‘ç°ä¸“é¢˜
â”‚   â”œâ”€â”€ basic/                         # åŸºç¡€ç”¨æ³•
â”‚   â”‚   â””â”€â”€ main.go                    # æœåŠ¡æ³¨å†Œ/å‘ç°/æ³¨é”€ã€å…ƒæ•°æ®ç®¡ç†
â”‚   â”œâ”€â”€ grpc-integration/             # gRPCé›†æˆ
â”‚   â”‚   â””â”€â”€ main.go                    # gRPC resolveråŠ¨æ€æœåŠ¡å‘ç°
â”‚   â””â”€â”€ health-check/                  # å¥åº·æ£€æŸ¥
â”‚       â””â”€â”€ main.go                    # æœåŠ¡å¥åº·çŠ¶æ€ç›‘æ§
â”œâ”€â”€ id-generator/                      # IDç”Ÿæˆå™¨ä¸“é¢˜
â”‚   â”œâ”€â”€ basic/                         # åŸºç¡€ç”¨æ³•
â”‚   â”‚   â””â”€â”€ main.go                    # å®ä¾‹IDåˆ†é…/é‡Šæ”¾ã€å®¹é‡ç®¡ç†
â”‚   â”œâ”€â”€ patterns/                      # ä½¿ç”¨æ¨¡å¼
â”‚   â”‚   â””â”€â”€ main.go                    # IDæ± ç®¡ç†ã€å¹¶å‘åˆ†é…ã€ç§Ÿçº¦ç®¡ç†
â”‚   â””â”€â”€ integration/                   # é›†æˆä½¿ç”¨
â”‚       â””â”€â”€ main.go                    # ä¸å…¶ä»–åŠŸèƒ½é…åˆä½¿ç”¨
â””â”€â”€ comprehensive/                     # ç»¼åˆç¤ºä¾‹ï¼ˆé«˜çº§åœºæ™¯ï¼‰
    â”œâ”€â”€ microservice/                  # å¾®æœåŠ¡åœºæ™¯
    â”‚   â””â”€â”€ main.go                    # å®Œæ•´çš„å¾®æœåŠ¡åè°ƒç¤ºä¾‹
    â””â”€â”€ benchmark/                     # æ€§èƒ½æµ‹è¯•
        â””â”€â”€ main.go                    # æ€§èƒ½åŸºå‡†æµ‹è¯•å’Œå¯¹æ¯”
```

## ğŸ”§ ç¯å¢ƒè¦æ±‚

### å‰ç½®æ¡ä»¶

- Go 1.19+
- etcd 3.4+ ï¼ˆè¿è¡Œåœ¨ `localhost:2379`ï¼‰

### å¯åŠ¨ etcd

å¦‚æœè¿˜æ²¡æœ‰è¿è¡Œ etcdï¼Œå¯ä»¥ä½¿ç”¨ Docker å¯åŠ¨ï¼š

```bash
# å¯åŠ¨ etcd
docker run -d --name etcd \
  -p 2379:2379 \
  -p 2380:2380 \
  quay.io/coreos/etcd:v3.5.0 \
  /usr/local/bin/etcd \
  --name etcd0 \
  --advertise-client-urls http://localhost:2379 \
  --listen-client-urls http://0.0.0.0:2379 \
  --initial-advertise-peer-urls http://localhost:2380 \
  --listen-peer-urls http://0.0.0.0:2380 \
  --initial-cluster etcd0=http://localhost:2380
```

## ğŸ“š åŠŸèƒ½è¯¦è§£

### 1. åˆ†å¸ƒå¼é” (Distributed Lock)

æä¾›åŸºäº etcd session çš„åˆ†å¸ƒå¼é”å®ç°ï¼Œæ”¯æŒè‡ªåŠ¨ç»­çº¦å’Œæ‰‹åŠ¨ç®¡ç†ã€‚

#### ç‰¹æ€§
- âœ… é˜»å¡å’Œéé˜»å¡è·å–æ¨¡å¼
- âœ… TTL è‡ªåŠ¨ç»­çº¦æœºåˆ¶
- âœ… æ‰‹åŠ¨ç»­çº¦å’Œè¿‡æœŸæ£€æŸ¥
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
- âœ… å¹¶å‘å®‰å…¨ä¿è¯

#### é€‚ç”¨åœºæ™¯
- èµ„æºäº’æ–¥è®¿é—®
- ä»»åŠ¡è°ƒåº¦
- åˆ†å¸ƒå¼äº‹åŠ¡åè°ƒ
- é˜²æ­¢é‡å¤æ“ä½œ

#### å¿«é€Ÿç¤ºä¾‹
```go
// è·å–é”æœåŠ¡
lockService := provider.Lock()

// é˜»å¡è·å–é”
lock, err := lockService.Acquire(ctx, "my-resource", 10*time.Second)
if err != nil {
    log.Fatal(err)
}
defer lock.Unlock(ctx)

// å—ä¿æŠ¤çš„æ“ä½œ
fmt.Println("æ‰§è¡Œå—ä¿æŠ¤çš„å·¥ä½œ...")

// æ£€æŸ¥TTL
ttl, _ := lock.TTL(ctx)
fmt.Printf("é”å‰©ä½™TTL: %v\n", ttl)
```

---

### 2. é…ç½®ä¸­å¿ƒ (Config Center)

æä¾›ç»Ÿä¸€çš„é…ç½®ç®¡ç†ï¼Œæ”¯æŒç‰ˆæœ¬æ§åˆ¶ã€åŠ¨æ€æ›´æ–°å’Œç±»å‹å®‰å…¨ã€‚

#### ç‰¹æ€§
- âœ… é…ç½®çš„å¢åˆ æ”¹æŸ¥
- âœ… ç‰ˆæœ¬æ§åˆ¶å’ŒCASæ“ä½œ
- âœ… é…ç½®å‰ç¼€ç®¡ç†
- âœ… åŠ¨æ€é…ç½®ç›‘å¬
- âœ… ç±»å‹å®‰å…¨çš„é…ç½®ç®¡ç†å™¨

#### é€‚ç”¨åœºæ™¯
- åº”ç”¨é…ç½®ç®¡ç†
- åŠŸèƒ½å¼€å…³æ§åˆ¶
- ç¯å¢ƒé…ç½®åŒæ­¥
- è¿è¡Œæ—¶é…ç½®æ›´æ–°

#### å¿«é€Ÿç¤ºä¾‹
```go
// è·å–é…ç½®æœåŠ¡
configService := provider.Config()

// è®¾ç½®é…ç½®
appConfig := AppConfig{
    AppName: "my-app",
    Version: "1.0.0",
    Port:    8080,
}

err := configService.Set(ctx, "config/app", appConfig)
if err != nil {
    log.Fatal(err)
}

// è·å–é…ç½®
var retrievedConfig AppConfig
err = configService.Get(ctx, "config/app", &retrievedConfig)
if err != nil {
    log.Fatal(err)
}
```

---

### 3. æœåŠ¡æ³¨å†Œå‘ç° (Service Discovery)

æä¾›å®Œæ•´çš„æœåŠ¡æ³¨å†Œã€å‘ç°å’Œå¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œæ”¯æŒ gRPC é›†æˆã€‚

#### ç‰¹æ€§
- âœ… æœåŠ¡æ³¨å†Œå’Œæ³¨é”€
- âœ… æœåŠ¡å‘ç°å’ŒæŸ¥è¯¢
- âœ… ä¸°å¯Œçš„å…ƒæ•°æ®æ”¯æŒ
- âœ… gRPC resolver é›†æˆ
- âœ… å¥åº·çŠ¶æ€ç›‘æ§
- âœ… å¤šå®ä¾‹è´Ÿè½½å‡è¡¡

#### é€‚ç”¨åœºæ™¯
- å¾®æœåŠ¡æ¶æ„
- æœåŠ¡ç½‘æ ¼
- åŠ¨æ€è´Ÿè½½å‡è¡¡
- æœåŠ¡æ²»ç†

#### å¿«é€Ÿç¤ºä¾‹
```go
// è·å–æ³¨å†ŒæœåŠ¡
registryService := provider.Registry()

// æ³¨å†ŒæœåŠ¡
serviceInfo := registry.ServiceInfo{
    ID:      "instance-1",
    Name:    "my-service",
    Address: "127.0.0.1",
    Port:    8080,
    Metadata: map[string]string{
        "version": "1.0.0",
        "region":  "local",
    },
}

err := registryService.Register(ctx, serviceInfo, 30*time.Second)
if err != nil {
    log.Fatal(err)
}
defer registryService.Unregister(ctx, serviceInfo.ID)

// å‘ç°æœåŠ¡
services, err := registryService.Discover(ctx, "my-service")
if err != nil {
    log.Fatal(err)
}

for _, svc := range services {
    fmt.Printf("å‘ç°æœåŠ¡: %s:%d\n", svc.Address, svc.Port)
}
```

---

### 4. IDç”Ÿæˆå™¨ (ID Generator)

æä¾›åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„å”¯ä¸€å®ä¾‹IDåˆ†é…å’Œç®¡ç†ã€‚

#### ç‰¹æ€§
- âœ… å”¯ä¸€IDä¿è¯
- âœ… å®¹é‡ç®¡ç†
- âœ… ç§Ÿçº¦è‡ªåŠ¨ç®¡ç†
- âœ… å¹¶å‘å®‰å…¨åˆ†é…
- âœ… IDå›æ”¶æœºåˆ¶

#### é€‚ç”¨åœºæ™¯
- å¾®æœåŠ¡å®ä¾‹æ ‡è¯†
- åˆ†å¸ƒå¼ä»»åŠ¡åˆ†é…
- ä¼šè¯ç®¡ç†
- èµ„æºæ ‡è¯†

#### å¿«é€Ÿç¤ºä¾‹
```go
// è·å–IDåˆ†é…å™¨
allocatorService := provider.Allocator()

// åˆ†é…å®ä¾‹ID
instanceID, err := allocatorService.AcquireID(ctx)
if err != nil {
    log.Fatal(err)
}
defer instanceID.Close(ctx)

fmt.Printf("åˆ†é…åˆ°å®ä¾‹ID: %d\n", instanceID.ID())

// ä½¿ç”¨IDè¿›è¡Œå·¥ä½œ
fmt.Printf("å®ä¾‹ %d æ­£åœ¨å·¥ä½œ...\n", instanceID.ID())
```

## ğŸ¯ å­¦ä¹ è·¯å¾„

### åˆå­¦è€…

1. **å¼€å§‹** â†’ `getting-started/` - äº†è§£æ‰€æœ‰åŠŸèƒ½
2. **æ·±å…¥** â†’ `*/basic/` - å­¦ä¹ æ¯ä¸ªåŠŸèƒ½çš„åŸºç¡€ç”¨æ³•
3. **å®è·µ** â†’ `*/patterns/` - æŒæ¡å¸¸è§ä½¿ç”¨æ¨¡å¼

### è¿›é˜¶ç”¨æˆ·

1. **é«˜çº§ç‰¹æ€§** â†’ `*/advanced/` - å­¦ä¹ é«˜çº§åŠŸèƒ½å’Œæœ€ä½³å®è·µ
2. **é›†æˆä½¿ç”¨** â†’ `*/integration/` - äº†è§£åŠŸèƒ½é—´çš„é…åˆä½¿ç”¨
3. **æ€§èƒ½ä¼˜åŒ–** â†’ `comprehensive/benchmark/` - å­¦ä¹ æ€§èƒ½è°ƒä¼˜

### ç”Ÿäº§ç¯å¢ƒ

1. **å®Œæ•´ç¤ºä¾‹** â†’ `comprehensive/microservice/` - å‚è€ƒå®Œæ•´çš„å¾®æœåŠ¡å®ç°
2. **é”™è¯¯å¤„ç†** â†’ å­¦ä¹ å„ä¸ªç¤ºä¾‹ä¸­çš„é”™è¯¯å¤„ç†æ¨¡å¼
3. **ç›‘æ§å’Œæ—¥å¿—** â†’ äº†è§£å¦‚ä½•é›†æˆç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. èµ„æºç®¡ç†
- å§‹ç»ˆä½¿ç”¨ `defer` ç¡®ä¿èµ„æºé‡Šæ”¾
- æ­£ç¡®å¤„ç†ä¸Šä¸‹æ–‡å–æ¶ˆ
- åˆç†è®¾ç½®TTLå’Œç§Ÿçº¦æ—¶é—´

### 2. é”™è¯¯å¤„ç†
- æ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„é”™è¯¯
- å®ç°é€‚å½“çš„é‡è¯•æœºåˆ¶
- è®°å½•è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

### 3. å¹¶å‘å®‰å…¨
- é¿å…åœ¨å…³é”®è·¯å¾„ä¸­çš„é˜»å¡æ“ä½œ
- åˆç†ä½¿ç”¨è¶…æ—¶æ§åˆ¶
- æ³¨æ„èµ„æºç«äº‰æ¡ä»¶

### 4. æ€§èƒ½ä¼˜åŒ–
- æ‰¹é‡æ“ä½œä¼˜äºå•ä¸ªæ“ä½œ
- åˆç†ä½¿ç”¨è¿æ¥æ± 
- é¿å…é¢‘ç¹çš„é…ç½®æ›´æ–°

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **etcd è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ etcd æ˜¯å¦è¿è¡Œåœ¨ `localhost:2379`
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

2. **é”è·å–è¶…æ—¶**
   - å¢åŠ é”çš„TTLæ—¶é—´
   - æ£€æŸ¥æ˜¯å¦æœ‰æ­»é”
   - ä¼˜åŒ–é”çš„æŒæœ‰æ—¶é—´

3. **é…ç½®æ›´æ–°ä¸ç”Ÿæ•ˆ**
   - æ£€æŸ¥é…ç½®ç›‘å¬å™¨æ˜¯å¦æ­£ç¡®å¯åŠ¨
   - ç¡®è®¤é…ç½®è·¯å¾„æ­£ç¡®
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

4. **æœåŠ¡å‘ç°å¤±è´¥**
   - ç¡®è®¤æœåŠ¡å·²æ­£ç¡®æ³¨å†Œ
   - æ£€æŸ¥æœåŠ¡åç§°æ˜¯å¦åŒ¹é…
   - éªŒè¯å…ƒæ•°æ®æ ¼å¼

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
   ```go
   cfg := coord.GetDefaultConfig("development")
   // æˆ–ä½¿ç”¨ "debug" è·å–æ›´è¯¦ç»†çš„æ—¥å¿—
   ```

2. **ä½¿ç”¨æµ‹è¯•å·¥å…·**
   ```bash
   # è¿è¡Œæµ‹è¯•éªŒè¯åŠŸèƒ½
   go test -v ./coord/...
   ```

3. **ç›‘æ§ etcd çŠ¶æ€**
   ```bash
   # æŸ¥çœ‹ etcd é”®å€¼
   etcdctl get --prefix /coord/
   ```

## ğŸ“– æ›´å¤šèµ„æº

- [API æ–‡æ¡£](../../docs/api.md)
- [è®¾è®¡æ–‡æ¡£](../../docs/design.md)
- [æ€§èƒ½æµ‹è¯•æŠ¥å‘Š](../../docs/performance.md)
- [éƒ¨ç½²æŒ‡å—](../../docs/deployment.md)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤é—®é¢˜å’Œæ”¹è¿›å»ºè®®ï¼è¯·å‚è€ƒé¡¹ç›®çš„ [è´¡çŒ®æŒ‡å—](../../CONTRIBUTING.md)ã€‚

---

**æ³¨æ„**: æ‰€æœ‰ç¤ºä¾‹éƒ½éœ€è¦ etcd æœåŠ¡è¿è¡Œåœ¨ `localhost:2379`ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¯·æ ¹æ®å®é™…ç¯å¢ƒä¿®æ”¹è¿æ¥é…ç½®ã€‚